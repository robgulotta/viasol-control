# Hardware Implemented

## Master Control Board

### Power
- 12-60VDC input buck to 12V
- 12V (dirty) distributed to remote comm board and heater boards for gate drive
- 12V to 3v3 dirty for isolator iso7741 and dirty side logic
- 12V to ISO_5V powering ESP32 and aux relay coils
- ISO_5V to 3v3 for ISO logic.

### MCU
- ESP32-s3-devkitC-v1.1

### Communications
- RS 485 via ISO 7741 from ESP32.  
- RJ45 pins 1 and 2 to remote comm board.
- biasing on master only
- termination on master
- wifi enabled for mqtt
 
### UI
- 8 pin header for aliexpress tft display
- 5 pin header for up, down, enter, back buttons

### Outputs
- 12VDC to remote comm board
- RJ45 to remote comm board
- Aux Comm header with DNP pullups, downs, series resistors and capacitors
- 3 Aux Relay
- 4 one wire headers (3 pin) for temp sensing

### Functions
- UI
- wifi, mqtt
- remote comm board data transfer
- send software updates

## Remote Comm Board

### Power
- 12VDC in from master control
- 3v3 from buck for ESP32, current sense, 485 xceiver, logic

### MCU
- esp32-s3-devkitC-v1.1

### Communications
- RS 485 from Master Comm, RJ45 pin 1 and 2
- terminator jumper to enable daisy chain
- Wifi disabled

### Inputs
- 12 VDC from master control
- PV + sense lead for pv voltage detect
- shunt leads from external shunt (INA180A2)

### Outputs
- 7 pin connectors x 8 for heater boards
- Leak sense
- heater enable
- current sense (return)
- 12V for gate drive
- 3v3 for current sense chip INA180A2
- onewire for heater board temp sensor
- RJ45 for daisy chain remote comm boards
- 12VDC for daisy chain

### Functions
- should contain logic for controlling heaters locally
- should contain input for diversion enabling or be able to get it from mqtt from master via 485
- should measure pv voltage and current overall
- individual heater channel current, leak sense, enable, temp

## Heater Board

### Power
- 12VDC and 3v3 input from Remote Comm Board

### Communication 
- Simple enable signal hi lo to gate drive
- current sense analog from ina180a2 back to remote comm
- leak sense via 1MOhm resistor pullup (down?) on one lead
- onewire for temp sensor
- no MCU

### Switching
- Low RDS(on) 650V mosfet (single) to enable PV to individual heater element low side switch
- Up to 12 or 15A but 20A possible with custom heatsink perhaps
- 12V gate drive chip for fet


